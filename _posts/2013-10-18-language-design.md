---
layout: article
title: 准备设计自己的编程语言
desc: 尝试编写自己的编程语言可以让你更深入的理解其他语言
---

编程语言是我们程序员和计算机沟通的工具，我们人类发明了很多自然语言，自然语言包含着人类的情感，但是编程语言是冷峻的，但是他们都可以有一个共同特质，***创造美***，不同的程序员对美的理解可能不一样，有人觉得C是美丽的语言，而有的人认为它反人类，有的人认为lisp是美的语言，而有的人讨厌的就是那一堆括号。这些都无关紧要，我们的大自然是按照美来设计的，作为程序员，让我们多做一些美的事情吧。

自然语言的本质是声音，而不是文字，因为人与人沟通的本质是声音，人发现某些东西是需要记录下来的，所以才发明了文字，所以我们人类的文字只是对声音概念的编码，我们和计算机沟通的本质不是声音而是逻辑，所以编程语言需要追求逻辑的严谨，有这样一个人，他叫乔姆斯基，对语言做了深入研究总结出了语言的多种文法类型，计算机编程语言是用上下文无关文法来描述的，而且几乎所有程序设计语言都是通过上下文无关文法来定义的。

个人认为音乐也是一种语言，一种表达情感的语言，它也可以被编码，用音符编码，音乐家创作音乐也是在编程。

明白语言的本质我们就可以准备发明我们自己的语言了，为什么发明语言呢，动机可能有几种：

1. 对目前任何图灵完备语言不爽
2. 学习的态度
3. 发明自己领域的DSL，解决当前的一个特殊问题

### 语言中要注意的问题

计算机的本质是计算，所以语言先要把计算表达出来，然后才是IO或者存储数据，数据存在类型和结构，运算分为逻辑运算，算术运算，位运算，所有的运算都会产生值。

数据：数字，字符，字符串（本质是字符的结构），布尔，代码本身也是数据

表达空的特殊数据：void,null,nil,undefined

结构：数组，哈希，关联数组，树状，链状，这里考虑是否设计进语言内核，比如java只内置了数组，其他都是语言库来实现的，但是ruby等语言，把部分结构直接表达在了语言里面，比如{"one"=> 1}，关于结构的组织，Lua更是设计了一个Table来包罗万象。

语法糖：可以用来非常简洁的表达程序中的某些公共概念，比如 array[-1]表示最后一个数组元素

代码和数据最终是需要组织在一起的，代码和数据形成闭包或者对象，或者C的结构，或者面向对象的类

元编程，宏替换，DSL，语言可扩展

编译器：编译为字节码，编译为平台机器码，编译为另外的语言，比如类似coffescript

解释器：直接解释执行，解释成字节码再执行

虚拟机执行字节码，虚拟机分为寄存器和栈结构两种

垃圾回收算法：引用计数，标记清扫，标记整理，复制。通过组合这些算法可一有分代，增量，并行，并发，保守等模式

语言API：提供扩展，集成

词法分析：直接机械分析字符串，去出注释和空格等特殊字符，提取关键字，运算符，标示符，也可利用实现语言的正则表达式

语法分析：手写递归下降，用工具生成LR,SLR等算法，手写也很简单

语言提供基本库：IO，正则表达式,字符串，网络，并发并行编程

语言范型：函数式，对象，原型，表格等。

编程到落地：算法处理数据，数据可能存在结构和不存在结构，结构可能影响算法，完整的计算机程序因为类型的声明导致阅读真正算法比较困难，我们只要语言清晰的表达结构和算法，而数据的类型通过设计一个算法去自动推断。

假设结构和算法都是发现和发明，现如今已经发现的算法和结构已经完全可以解决领域问题，那么剩下的就是组合这写结构和算法，这就是设计，设计是发明而不是发现

程序的设计也可以叫架构：面向对象，数据流，分层，集中式，分布式，切片，事件驱动，模型驱动，场景等

计算机中表示的数据是否可以全部归于实数：通过相对低效的处理表达所有精度运算？

字符串：可变还是不可变

布尔：是明确的布尔类型还是很多类型都可以布尔

用最少的代码量解决问题，同时也是工业化的，当程序变大，如何设计模块管理系统，命名空间，冲突管理

程序的基本单元：表达式，语句，表达式是某种运算，多个语句可以组成语句块，语句块有可以递归的出现在分支，循环，函数定义等语句中

单行语句用行结束来表达边界，多行语句可以用{},def end,缩进等方法来表达边界，或者用()S表达式
